<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LogiLoad Engineering v5.2</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root {
            --bg: #f4f7f6;
            --white: #ffffff;
            --gray-light: #f8f9fa;
            --gray-mid: #dfe6e9;
            --text: #2d3436;
            --accent: #0984e3;
            --danger: #d63031;
            --success: #00b894;
            --whatsapp: #25d366;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Roboto', sans-serif;
            margin: 0; padding-bottom: 110px;
        }

        h1, h2, h3, h4, h5, .ubuntu { font-family: 'Ubuntu', sans-serif; }

        /* --- HEADER & BADGES --- */
        .app-header {
            background: var(--white);
            padding: 20px;
            border-bottom: 2px solid var(--gray-mid);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky; top: 0; z-index: 1000;
        }

        .status-pill {
            font-size: 0.7rem; font-weight: 800; padding: 5px 15px;
            border-radius: 50px; text-transform: uppercase;
            border: 1px solid transparent;
        }
        .status-ok { background: #e3fcef; color: var(--success); border-color: var(--success); }
        .status-err { background: #fff0f0; color: var(--danger); border-color: var(--danger); }

        /* --- CARDS & HOVER --- */
        .card-eng {
            background: var(--white); border: 1px solid var(--gray-mid);
            border-radius: 12px; padding: 20px; margin-bottom: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-eng:hover {
            transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.08);
            border-color: var(--accent);
        }

        /* --- TIPO DE CARGA SELECTOR --- */
        .type-selector { display: flex; gap: 10px; margin-bottom: 20px; }
        .type-btn {
            flex: 1; padding: 15px; border: 1px solid var(--gray-mid);
            border-radius: 10px; text-align: center; cursor: pointer; transition: 0.2s;
            background: var(--gray-light);
        }
        .type-btn.active {
            background: var(--accent); color: white; border-color: var(--accent);
            box-shadow: 0 4px 12px rgba(9, 132, 227, 0.3);
        }

        /* --- INPUTS & SELECTS --- */
        .form-label { font-size: 0.75rem; font-weight: 700; color: #636e72; text-transform: uppercase; }
        .form-control, .form-select {
            border: 1px solid var(--gray-mid); background: var(--gray-light);
            border-radius: 8px; font-weight: 500;
        }
        .form-control:focus { box-shadow: 0 0 0 3px rgba(9, 132, 227, 0.1); border-color: var(--accent); }

        /* --- NAV BAR --- */
        .nav-logi {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 600px; background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px); border: 1px solid var(--gray-mid);
            border-radius: 20px; display: flex; justify-content: space-around;
            padding: 10px; box-shadow: 0 8px 30px rgba(0,0,0,0.15); z-index: 2000;
        }
        .nav-item {
            text-decoration: none; color: #636e72; font-size: 0.65rem;
            font-weight: 700; display: flex; flex-direction: column; align-items: center;
            transition: 0.3s;
        }
        .nav-item i { font-size: 1.4rem; margin-bottom: 2px; }
        .nav-item.active { color: var(--accent); }

        /* --- MODAL RESUMEN --- */
        .report-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none; align-items: center;
            justify-content: center; z-index: 3000;
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 20px;
            width: 90%; max-width: 450px; box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        .share-btn {
            width: 100%; padding: 12px; border-radius: 10px; border: none;
            margin-bottom: 10px; font-weight: 700; display: flex;
            align-items: center; justify-content: center; gap: 10px; transition: 0.2s;
        }
        .btn-pdf { background: #ff7675; color: white; }
        .btn-ws { background: var(--whatsapp); color: white; }
        .btn-mail { background: var(--accent); color: white; }
    </style>
</head>
<body>

<header class="app-header d-flex justify-content-between align-items-center">
    <div>
        <h5 class="mb-0 fw-bold"><i class="bi bi-gear-wide-connected text-primary"></i> LOGILOAD <span class="fw-light">V5.2</span></h5>
        <small class="text-muted">Terminal de Ingenier√≠a de Transporte</small>
    </div>
    <div id="top-status" class="status-pill status-ok">√ìptimo</div>
</header>

<main class="container mt-4">

    <div class="card-eng">
        <label class="form-label"><i class="bi bi-truck-flatbed me-2"></i>Tipo de Unidad / Flota</label>
        <select id="unit-select" class="form-select form-select-lg" onchange="app.calculate()">
            <optgroup label="Contenedores Mar√≠timos">
                <option value="1200|235|239|28000">40' High Cube (12m - 28T)</option>
                <option value="590|235|235|21000">20' Est√°ndar (5.9m - 21T)</option>
                <option value="1360|248|270|26000">45' Pallet Wide (13.6m - 26T)</option>
            </optgroup>
            <optgroup label="Semiremolques y Carretera">
                <option value="1350|245|270|32000">Semiremolque Sider (13.5m - 32T)</option>
                <option value="1350|240|260|30000">Frigor√≠fico / Reffer (13.5m - 30T)</option>
                <option value="1360|250|0|35000">Plataforma Abierta (13.6m - 35T)</option>
            </optgroup>
        </select>
    </div>

    <div class="type-selector">
        <div class="type-btn active" id="type-sq" onclick="app.setShape('square')">
            <i class="bi bi-box-seam d-block fs-4"></i><small class="fw-bold">C√∫bica</small>
        </div>
        <div class="type-btn" id="type-cy" onclick="app.setShape('cylindrical')">
            <i class="bi bi-circle-upside-down d-block fs-4"></i><small class="fw-bold">Cil√≠ndrica</small>
        </div>
    </div>

    <div class="row">
        <div class="col-md-7">
            <div class="card-eng">
                <h6 class="ubuntu fw-bold mb-3">M√©tricas de la Mercanc√≠a</h6>
                <div class="row g-3">
                    <div class="col-6">
                        <label class="form-label">Cant. Bultos</label>
                        <input type="number" id="qty" class="form-control" value="24" oninput="app.calculate()">
                    </div>
                    <div class="col-6">
                        <label class="form-label">Peso Un. (kg)</label>
                        <input type="number" id="weight" class="form-control" value="1000" oninput="app.calculate()">
                    </div>
                    <div class="col-4">
                        <label class="form-label" id="lbl-l">Largo (m)</label>
                        <input type="number" id="dim-l" class="form-control" value="1.2" step="0.1" oninput="app.calculate()">
                    </div>
                    <div class="col-4">
                        <label class="form-label" id="lbl-w">Ancho (m)</label>
                        <input type="number" id="dim-w" class="form-control" value="1.0" step="0.1" oninput="app.calculate()">
                    </div>
                    <div class="col-4">
                        <label class="form-label">Alto (m)</label>
                        <input type="number" id="dim-h" class="form-control" value="1.1" step="0.1" oninput="app.calculate()">
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-5">
            <div class="card-eng text-center bg-light border-0">
                <h6 class="ubuntu small fw-bold opacity-50">OCUPACI√ìN DE MASA BRUTA</h6>
                <h1 id="total-weight" class="fw-bold mb-0">0</h1>
                <small class="fw-bold text-muted">KILOGRAMOS TOTALES</small>
                <div class="progress mt-3" style="height: 10px;">
                    <div id="weight-bar" class="progress-bar bg-primary" style="width: 0%"></div>
                </div>
                <div id="usage-text" class="small mt-2 fw-bold">0% de capacidad usada</div>
            </div>
        </div>
    </div>

    <div class="card-eng border-primary bg-white shadow-sm" onclick="app.optimize()">
        <div class="d-flex align-items-center justify-content-between cursor-pointer">
            <div>
                <h6 class="mb-0 ubuntu fw-bold text-primary"><i class="bi bi-cpu me-2"></i>Optimizar Distribuci√≥n</h6>
                <small class="text-muted">Ajustar dimensiones para m√°xima eficiencia</small>
            </div>
            <i class="bi bi-chevron-right text-primary"></i>
        </div>
        <div id="opt-tip" class="mt-3 p-2 bg-light rounded small d-none border-start border-primary border-4"></div>
    </div>

</main>

<div class="report-modal" id="modal-report">
    <div class="modal-content">
        <div class="d-flex justify-content-between align-items-start mb-4">
            <h5 class="fw-bold ubuntu mb-0">Resumen de Carga</h5>
            <button class="btn-close" onclick="app.closeModal()"></button>
        </div>
        
        <div id="summary-data" class="bg-light p-3 rounded mb-4 small">
            </div>

        <button class="share-btn btn-pdf" onclick="app.exportPDF()">
            <i class="bi bi-file-earmark-pdf"></i> Descargar Reporte PDF
        </button>
        <button class="share-btn btn-ws" onclick="app.shareWS()">
            <i class="bi bi-whatsapp"></i> Enviar por WhatsApp
        </button>
        <button class="share-btn btn-mail" onclick="app.shareMail()">
            <i class="bi bi-envelope"></i> Enviar por Email
        </button>
    </div>
</div>

<nav class="nav-logi">
    <a href="#" class="nav-item active"><i class="bi bi-calculator-fill"></i><span>INGENIER√çA</span></a>
    <a href="javascript:app.openModal()" class="nav-item"><i class="bi bi-send-fill"></i><span>DESPACHAR</span></a>
    <a href="javascript:location.reload()" class="nav-item"><i class="bi bi-trash3-fill"></i><span>LIMPIAR</span></a>
</nav>

<script>
const app = {
    shape: 'square',
    data: {},

    setShape(type) {
        this.shape = type;
        document.getElementById('type-sq').classList.toggle('active', type === 'square');
        document.getElementById('type-cy').classList.toggle('active', type === 'cylindrical');
        document.getElementById('lbl-l').innerText = type === 'square' ? 'Largo (m)' : 'Di√°metro (m)';
        document.getElementById('lbl-w').innerText = type === 'square' ? 'Ancho (m)' : 'Altura (m)';
        this.calculate();
    },

    calculate() {
        const v = document.getElementById('unit-select').value.split('|');
        const unit = { l: +v[0], w: +v[1], h: +v[2], max: +v[3], name: document.getElementById('unit-select').selectedOptions[0].text };
        
        const qty = +document.getElementById('qty').value;
        const wUn = +document.getElementById('weight').value;
        const totalW = qty * wUn;
        const perc = (totalW / unit.max) * 100;

        // UI Updates
        document.getElementById('total-weight').innerText = totalW.toLocaleString();
        document.getElementById('weight-bar').style.width = Math.min(perc, 100) + "%";
        document.getElementById('usage-text').innerText = perc.toFixed(1) + "% de la capacidad usada";
        
        const status = document.getElementById('top-status');
        if(perc > 100) {
            status.className = "status-pill status-err";
            status.innerText = "¬°Sobrepeso!";
            document.getElementById('weight-bar').className = "progress-bar bg-danger";
        } else {
            status.className = "status-pill status-ok";
            status.innerText = "Seguro";
            document.getElementById('weight-bar').className = "progress-bar bg-primary";
        }

        this.data = { unit, totalW, qty, wUn, perc };
    },

    optimize() {
        const tip = document.getElementById('opt-tip');
        tip.classList.remove('d-none');
        
        const v = this.data.unit;
        const dl = +document.getElementById('dim-l').value * 10;
        const dw = +document.getElementById('dim-w').value * 10;
        
        const cap = Math.floor(v.l / dl) * Math.floor(v.w / dw);
        
        if (this.data.perc > 100) {
            const ideal = Math.floor(v.max / this.data.wUn);
            tip.innerHTML = `‚ö†Ô∏è <strong>ALERTA:</strong> Exceso de peso. Retire ${this.data.qty - ideal} unidades para no exceder las ${v.max/1000} toneladas.`;
        } else if (this.data.qty > cap) {
            tip.innerHTML = `üìê <strong>TIP:</strong> No caben en un nivel. Debe estibar en 2 niveles o usar configuraci√≥n en espiga.`;
        } else {
            tip.innerHTML = `‚úÖ <strong>√ìPTIMO:</strong> La carga entra perfectamente en la base de la unidad.`;
        }
    },

    openModal() {
        this.calculate();
        const d = this.data;
        document.getElementById('summary-data').innerHTML = `
            <strong>UNIDAD:</strong> ${d.unit.name}<br>
            <strong>CARGA TOTAL:</strong> ${d.totalW.toLocaleString()} kg (${d.perc.toFixed(1)}%)<br>
            <strong>CANTIDAD:</strong> ${d.qty} unidades de ${d.wUn} kg<br>
            <strong>ESTADO:</strong> ${d.perc > 100 ? 'FUERA DE NORMA' : 'DENTRO DE NORMA'}
        `;
        document.getElementById('modal-report').style.display = 'flex';
    },

    closeModal() { document.getElementById('modal-report').style.display = 'none'; },

    exportPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFont("helvetica", "bold");
        doc.text("MANIFIESTO DE CARGA - LOGILOAD", 20, 20);
        doc.setFont("helvetica", "normal");
        doc.text(`Unidad: ${this.data.unit.name}`, 20, 35);
        doc.text(`Carga Bruta: ${this.data.totalW} kg`, 20, 45);
        doc.text(`Cantidad: ${this.data.qty} bultos`, 20, 55);
        doc.save("Reporte_Carga.pdf");
    },

    shareWS() {
        const msg = encodeURIComponent(`üì¶ *LogiLoad Report*\nUnidad: ${this.data.unit.name}\nPeso: ${this.data.totalW}kg\nEstado: ${this.data.perc > 100 ? 'SOBREPESO' : 'OK'}`);
        window.open(`https://wa.me/?text=${msg}`);
    },

    shareMail() {
        const subject = encodeURIComponent("Reporte de Ingenier√≠a de Carga");
        const body = encodeURIComponent(`Resumen Log√≠stico:\nVeh√≠culo: ${this.data.unit.name}\nPeso Total: ${this.data.totalW}kg\nUso: ${this.data.perc.toFixed(1)}%`);
        window.location.href = `mailto:?subject=${subject}&body=${body}`;
    }
};

window.onload = () => app.init();
</script>
</body>
</html>